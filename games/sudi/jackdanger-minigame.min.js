/*! sudi 2016-03-15 */
!function(){var RequireRuntime=function(){"use strict";function t(){}return t.later=function(){this.callbacks=[],this.errors=[],this.cerror=null,this.cdata=null,this.then=function(t,e){return this.cdata?this.cdata=t(this.cdata):this.cerror&&e?e(this.ccerror):(this.callbacks&&t&&this.callbacks.push(t),this.errors&&e&&this.errors.push(e),this.cdata?this.cdata=t(this.cdata):this.cerror&&e&&e(this.ccerror)),this},this.call=function(t,e,i){this[i]=t;for(var s in this[e]){var r=this[e][s](this[i]);r&&(this[i]=r)}this.callbacks=null,this.errors=null},this.resolve=function(t){this.cdata||this.cerror||this.call(t,"callbacks","cdata")},this.reject=function(t){this.cdata||this.cerror||(console.warn("Defer was rejected: "+t),this.call(t,"errors","cerror"))}},t.module_defines={},t.modules={},t.file_registry={},t.dependencies_resolved=function(e){for(var i in e)if(void 0==t.modules[e[i]]||t.modules[e[i]].then)return!1;return!0},t.instantiateBlock=function(e,i){t.dependencies_resolved(i)&&e.apply(0,t.mapDependencies(i))},t.instantiateModule=function(e,i,s){t.dependencies_resolved(i)&&(t.modules[e]=t.module_defines[e].module.apply(0,t.mapDependencies(i))||{},s.resolve(t.modules[e]))},t.mapDependencies=function(e){return e.map(function(e){return t.modules[e]})},t.createModule=function(e){var i=new t.later;if(!t.module_defines[e])return t.modules[e]={},i.resolve({}),i;if(t.modules[e]=i,t.module_defines[e].dependencies.length>0)for(var s in t.module_defines[e].dependencies){var r=t.module_defines[e].dependencies[s];t.resolve(r).then(function(s){t.instantiateModule(e,t.module_defines[e].dependencies,i)})}else t.instantiateModule(e,[],i);return i},t.resolve=function(e){var i=new t.later;if(t.modules[e])t.modules[e]instanceof t.later?t.modules[e].then(function(t){i.resolve(t)}):i.resolve(t.modules[e]);else if(t.module_defines[e])t.createModule(e).then(function(t){i.resolve(t)});else{if(t.file_registry[e+".js"])return t.file_registry[e+".js"];t.file_registry[e+".js"]=i;var s=document.getElementsByTagName("head")[0],r=document.createElement("script");r.src=e+".js",r.addEventListener("load",function(){console.log("loaded file ("+e+")"),t.createModule(e).then(function(t){i.resolve(t)})}),r.addEventListener("error",function(){console.log("loaded file ("+e+")"),i.resolve(e)}),s.appendChild(r)}return i},t.require=function(e,i){if(e instanceof Array)for(var s in e)t.resolve(e[s]).then(function(){t.instantiateBlock(i,e)});else t.resolve(e).then(i)},t.define=function(e,i){var s=[],r=null;if(i instanceof Array)for(var o in i)o<i.length-1?s.push(i[o]):r=i[o];else r=i;t.module_defines[e]={dependencies:s,module:r}},t}(),require=RequireRuntime.require,define=RequireRuntime.define;define("lib/html",[function(){function t(){this.parse=function(t){var e=new DOMParser,i=e.parseFromString(t,"text/html");return i}}return new t}]),define("lib/dependency_loader",["lib/http","lib/html",function(t,e){function i(){}return i.prototype.load=function(i){var s=new RequireRuntime.later;return t.get(i).then(function(t){for(var s=[],r=0;r<e.parse(t).body.getElementsByTagName("a").length;r++){var o=e.parse(t).body.getElementsByTagName("a")[r],n=o.getAttribute("href");(result=n.match(/(\w+).js$/))&&s.push(i+"/"+result[1])}return s}).then(function(t){RequireRuntime.require(t,function(){console.log("All dependencies loaded"),s.resolve(t)})}),s},new i}]),define("lib/http",[function(){function t(){console.warn("create Http class"),this.get=function(t){var e=new RequireRuntime.later,i=new XMLHttpRequest;return i.onreadystatechange=function(t){4==i.readyState&&e.resolve(i.response)},i.open("GET",t),i.send(),e}}return new t}]),define("games/sudi/src/map",["games/sudi/src/spritesheet_generator",function(t){function e(t,e){this.state=t,this.entity_manager=e}return e.prototype.load=function(e,i){this.map=this.state.game.add.tilemap(e);for(var s in this.map.tilesets)t.createSpriteSheet(i,this.map.tilesets[s].name),this.map.addTilesetImage(this.map.tilesets[s].name,this.map.tilesets[s].name);this.groundlayer=this.map.createLayer("groundlayer"),this.groundlayer.resizeWorld(),this.createCollsionLayer(),this.createTrigger(),this.entity_manager.setWorldGeometry(this.collisionLayer),this.spawnEntities()},e.prototype.createTrigger=function(){this.findObjectsByType(null,"trigger",function(t){this.entity_manager.create_trigger_from_element(t)},this)},e.prototype.createCollsionLayer=function(){this.collisionLayer=this.state.game.add.group(),this.collisionLayer.enableBody=!0,this.collisionLayer.physicsBodyType=Phaser.Physics.ARCADE,this.collisionLayer.debug=!0,this.findObjectsByType(null,"collision",function(t){var e=this.collisionLayer.create(t.x,t.y);e.body.setSize(t.width,t.height),e.body.immovable=!0},this)},e.prototype.spawnEntities=function(){var t=this.findObjectsByType(null,"entities");for(var e in t)this.entity_manager.create_entity_from_element(t[e])},e.prototype.findObjectsByType=function(t,e,i,s){var r=new Array;return this.map.objects[e].forEach(function(e){t&&e.properties.type!==t||(i&&i.call(s,e),r.push(e))}),r},e}]),define("games/sudi/src/player",["games/sudi/src/sound_system","games/sudi/src/hud",function(t,e){function i(t,e){this.state=t,this.group=e,this.duck=!1,this.speed=100,this.shoot=0,this.sprite=this.state.add.sprite(0,0,"jack"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.sprite.animations.add("idle",[0,1,2,1],5),this.sprite.animations.add("walk",[0,3,4,3],14),this.sprite.animations.add("jump",[2],7),this.sprite.animations.add("duck",[5],7),this.sprite.animations.add("duck_walk",[5,6,7,6],7),this.sprite.play("idle",7,!0),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.reset_body_size(),this.sprite.body.gravity.y=600,this.sprite.body.immovable=!1,this.sprite.body.collideWorldBounds=!0,this.state.camera.follow(this.sprite,Phaser.Camera.FOLLOW_PLATFORMER)}return i.instance={},i.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},i.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},i.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},i.prototype.damage=function(t){e.cinematic||this.kill()},i.prototype.reset_body_size=function(){this.duck?this.sprite.body.setSize(10,16):this.sprite.body.setSize(10,30)},i.prototype.update=function(t){if(this.on_floor=this.sprite.body.onFloor()||this.sprite.body.touching.down,e.cinematic)this.sprite.body.velocity.x=0;else{this.controls(t)}this.shoot>0&&(this.shoot-=t),e.coins=this.get("coins"),e.worms=this.get("worms")},i.prototype.onFloor=function(){return this.on_floor},i.prototype.kill=function(){onLose()},i.prototype.controls=function(){var e=!1;return Pad.isDown(Pad.LEFT)&&(this.sprite.body.velocity.x=-this.speed*(this.duck?.5:1),e=!0,this.duck?this.sprite.play("duck_walk"):this.sprite.play("walk"),this.sprite.scale.x=-1),Pad.isDown(Pad.RIGHT)&&(this.sprite.body.velocity.x=this.speed*(this.duck?.5:1),e=!0,this.duck?this.sprite.play("duck_walk"):this.sprite.play("walk"),this.sprite.scale.x=1),(Pad.isDown(Pad.UP)||Pad.isDown(Pad.JUMP))&&this.onFloor()&&(this.sprite.body.velocity.y=-200,e=!0,t.play("jump")),Pad.justDown(Pad.SHOOT)&&this.get("worms")>0&&this.shoot<=0&&(this.manager.fireBullet(this),this.set("worms",this.get("worms")-1),this.shoot=.5),Pad.isDown(Pad.DOWN)?this.duck=!0:this.duck=!1,this.reset_body_size(),e||(this.duck?this.sprite.play("duck"):this.sprite.play("idle"),this.onFloor()&&(this.sprite.body.velocity.x=0)),this.onFloor()||this.sprite.play("jump"),e},i}]),define("games/sudi/src/hud",[function(){function t(){this.coins=0,this.worms=0,this.cinematic=!1,this.hud_elements=null}return t.prototype.init=function(t){this.state=t,this.cinematic=!1,this.hud_elements=this.state.add.group(),this.hud_elements.fixedToCamera=!0,this.generateBars(),this.generateSpeechBox(),this.speech_box=this.hud_elements.create(128,272,"speech_box"),this.speech_box_name=this.state.add.bitmapText(160,272,"testfont","GESCHAFFT",20,this.hud_elements),this.speech_box_text=this.state.add.bitmapText(160,294,"testfont","GESCHAFFT",20,this.hud_elements),this.speech_box_text.maxWidth=480,this.speech_box.exists=!1,this.speech_box_name.exists=!1,this.speech_box_text.exists=!1,this.coin=this.hud_elements.create(5,0,"atlas","coin_hud_0000"),this.coin.animations.add("idle",Phaser.Animation.generateFrameNames("coin_hud_",0,5,"",4),5),this.coin.play("idle",5,!0),this.worm=this.hud_elements.create(5,40,"atlas","wormbullet"),this.worm.animations.add("idle",Phaser.Animation.generateFrameNames("wormbullet_",0,2,"",4),5),this.worm.play("idle",5,!0),this.coinText=this.state.add.bitmapText(40,10,"testfont","GESCHAFFT",20,this.hud_elements),this.wormText=this.state.add.bitmapText(40,40,"testfont","GESCHAFFT",20,this.hud_elements)},t.prototype.showBars=function(){this.state.add.tween(this.topbar).to({y:0},1e3,Phaser.Easing.Bounce.Out,!0),this.state.add.tween(this.bottombar).to({y:430},1e3,Phaser.Easing.Bounce.Out,!0),this.cinematic=!0},t.prototype.hideBars=function(){this.state.add.tween(this.topbar).to({y:-20},1e3,Phaser.Easing.Bounce.Out,!0),this.state.add.tween(this.bottombar).to({y:450},1e3,Phaser.Easing.Bounce.Out,!0),this.cinematic=!1},t.prototype.update=function(){this.coinText.text="Coins     "+this.coins,this.wormText.text="Worms  "+this.worms,this.state.game.world.bringToTop(this.hud_elements)},t.prototype.speech=function(t){this.speech_box.exists=!0,this.speech_box_name.exists=!0,this.speech_box_text.exists=!0,this.speech_box_name.text=t.name,this.speech_box_text.text=t.text},t.prototype.hideSpeech=function(t){this.speech_box.exists=!1,this.speech_box_name.exists=!1,this.speech_box_text.exists=!1},t.prototype.generateSpeechBox=function(){for(var t=17,e=5,i=this.state.add.bitmapData(32*t,32*e),s=this.state.make.sprite(0,0,"atlas","speech_0000"),r=this.state.make.sprite(0,0,"atlas","speech_0001"),o=this.state.make.sprite(0,0,"atlas","speech_0002"),n=this.state.make.sprite(0,0,"atlas","speech_0003"),a=this.state.make.sprite(0,0,"atlas","speech_0004"),h=this.state.make.sprite(0,0,"atlas","speech_0005"),p=this.state.make.sprite(0,0,"atlas","speech_0006"),d=this.state.make.sprite(0,0,"atlas","speech_0007"),u=this.state.make.sprite(0,0,"atlas","speech_0008"),c=0;t>c;c++)for(var l=0;e>l;l++)0==c&&0==l?i.draw(s,32*c,32*l):c==t-1&&0==l?i.draw(o,32*c,32*l):0==c&&l!=e-1&&0!=l?i.draw(n,32*c,32*l):0==c&&l==e-1?i.draw(p,32*c,32*l):c==t-1&&l!=e-1&&0!=l?i.draw(h,32*c,32*l):c==t-1&&l==e-1?i.draw(u,32*c,32*l):c!=t-1&&0!=c&&l==e-1?i.draw(d,32*c,32*l):c!=t-1&&0!=c&&0==l?i.draw(r,32*c,32*l):i.draw(a,32*c,32*l);this.state.cache.addImage("speech_box","",i.canvas)},t.prototype.generateBars=function(){var t=this.state.add.graphics(0,0);t.lineStyle(0),t.beginFill(0,1),t.drawRect(0,0,800,20);var e=t.generateTexture();this.topbar=this.hud_elements.create(0,-20,e),this.bottombar=this.hud_elements.create(0,450,e),t.destroy()},new t}]),define("games/sudi/src/speech",["games/sudi/src/hud",function(t){function e(t,e){this.name=t,this.text=e}function i(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(),this.sprite.entity=this,this.group&&this.group.add(this.sprite),this.active=!1,this.texts=[],this.current=0}return i.shown={},i.prototype.set=function(t,i){if("texts"==t){var s=i.split(";");for(var r in s){var o=s[r].split("|");this.texts.push(new e(o[0],o[1]))}}this.properties=this.properties||{},this.properties[t]=i},i.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},i.prototype.setPosition=function(t,e){this.x=t,this.y=e},i.prototype.damage=function(t){},i.prototype.update=function(e){this.active&&Pad.justDown(Pad.SHOOT)&&(this.current+=1,this.current<this.texts.length?t.speech(this.texts[this.current]):(this.current=0,this.active=!1,t.hideBars(),t.hideSpeech(),this.get("target")&&this.manager.triggerById(parseInt(this.get("target")),this,this.entity,!0),this.entity=null))},i.prototype.interact=function(t){},i.prototype.trigger=function(e,s){JSON.parse(this.get("show_once"))&&i.shown[this.id]||(i.shown[this.id]=!0,this.active=!0,this.current=0,this.entity=s,t.showBars(),t.speech(this.texts[this.current]))},i.prototype.trigger_end=function(t,e){},i}]),define("games/sudi/src/music",["games/sudi/src/sound_system",function(t){function e(t,e){this.sprite=t.add.sprite(),this.group=e,this.sprite.entity=this,e&&e.addChild(this.sprite)}return e.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},e.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},e.prototype.setPosition=function(t,e){},e.prototype.damage=function(t){},e.prototype.update=function(t){},e.prototype.interact=function(t){},e.prototype.trigger=function(e,i){t.theme(this.get("music"))},e.prototype.trigger_end=function(t,e){},e}]),define("games/sudi/src/cloud",function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"atlas","cloud_0000"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,.5),this.sprite.scale.set(1),this.sprite.angle=0,this.sprite.animations.add("die",Phaser.Animation.generateFrameNames("cloud_",0,7,"",4),12),this.sprite.animations.add("spawn",Phaser.Animation.generateFrameNames("cloud_",0,7,"",4).reverse(),12),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(32,10,0,8),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.dead=!1,this.respawn=1,this.respawn_timer=0}return t.prototype.set=function(t,e){"despawn"==t&&JSON.parse(e)&&(this.sprite.exists=!1),this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},"respawn"==t?this.properties.respawn?parseFloat(this.properties.respawn):5:this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.damage=function(t){},t.prototype.shouldCollide=function(t){return t.sprite.body.velocity.y>0&&t.sprite.body.position.y+t.sprite.body.height-10<this.sprite.body.position.y},t.prototype.update=function(t){this.sprite.exists&&this.dead&&(this.respawn_timer>0?this.respawn_timer-=t:(this.dead=!1,this.sprite.body.enable=!0,this.sprite.play("spawn")))},t.prototype.interact=function(t){!this.dead&&this.sprite.body.touching.up&&(this.respawn_timer=this.get("respawn"),this.dead=!0,this.sprite.body.enable=!1,this.sprite.play("die"))},t.prototype.trigger=function(t,e){this.sprite.exists||(this.sprite.exists=!0,this.dead=!1,this.sprite.body.enable=!0,this.sprite.play("spawn"))},t.prototype.trigger_end=function(t,e){},t}),define("games/sudi/src/collectable",["games/sudi/src/sound_system",function(t){function e(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.anim=null,this.frames=null,this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.immovable=!1,this.sprite.body.collideWorldBounds=!0}return e.totalCount={},e.prototype.startAnimation=function(){this.frames&&(this.anim=this.sprite.animations.add("idle",this.frames,this.fps),this.anim.play(this.fps,!0))},e.prototype.set=function(t,i){if("anchor"==t&&(values=i.split(","),this.sprite.anchor.set(parseFloat(values[0]),parseFloat(values[1]))),"size"==t){for(values=i.split(",");values.length<4;)values.push(0);this.sprite.body.setSize(parseFloat(values[0]),parseFloat(values[1]),parseFloat(values[2]),parseFloat(values[3]))}"scale"==t&&(values=i.split(","),this.sprite.scale.set(parseFloat(values[0]),parseFloat(values[1]))),"animation"==t&&(values=i.split(","),this.frames=values,this.fps=12,parseInt(values[values.length-1])&&(this.frames=values.slice(0,values.length-1),this.fps=values[values.length-1])),"sprite"==t&&(values=i.split(","),values.length>1?this.sprite.loadTexture(values[0],values[1]):this.sprite.loadTexture(values[0]),this.startAnimation()),"gravity"==t&&(this.sprite.body.gravity.y=parseFloat(i)),"name"==t&&(e.totalCount[i]=e.totalCount[i]||0,e.totalCount[i]+=1),"bounce"==t&&(values=i.split(","),values.length>1?this.sprite.body.bounce.set(values[0],values[1]):this.sprite.body.bounce.set(values[0])),this.properties=this.properties||{},this.properties[t]=i},e.prototype.get=function(t,e){return this.properties=this.properties||{},"amount"==t?parseInt(this.properties[t])||1:this.properties[t]||0},e.prototype.setPosition=function(t,e){this.x=this.sprite.x=t-8,this.y=this.sprite.y=e},e.prototype.damage=function(t){},e.prototype.update=function(t){},e.prototype.interact=function(e){e.set(this.get("name"),e.get(this.get("name"))+this.get("amount")),t.play(this.get("sound")),this.owner=null,this.manager=null,this.sprite.entity=null,this.sprite.destroy()},e.prototype.trigger=function(t,e){},e.prototype.trigger_end=function(t,e){},e}]),define("games/sudi/src/trapdoor",function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"trapdoor"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.04,.97),this.sprite.scale.set(1),this.sprite.angle=0,this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(64,10,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.opened=!1}return t.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.damage=function(t){},t.prototype.update=function(t){this.opened&&this.sprite.angle>-90?this.sprite.angle-=45*t:!this.opened&&this.sprite.angle<0?this.sprite.angle+=45*t:this.sprite.angle>0?this.sprite.angle=0:this.sprite.angle<-90&&(this.sprite.angle=-90)},t.prototype.open=function(){this.opened=!0},t.prototype.close=function(){},t.prototype.interact=function(t){},t.prototype.trigger=function(t,e){this.opened&&this.sprite.angle<=-90?(this.sprite.body.setSize(64,10,0,0),this.opened=!1):!this.opened&&this.sprite.angle>=0&&(this.sprite.body.setSize(10,64,0,0),this.opened=!0)},t.prototype.trigger_end=function(t,e){},t}),define("games/sudi/src/flag",["games/sudi/src/collectable",function(t){function e(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"flag"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(16,32,0,0),this.sprite.body.immovable=!0}return e.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},e.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},e.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},e.prototype.update=function(t){},e.prototype.interact=function(t){onVictory()},e}]),define("games/sudi/src/tourtle",["games/sudi/src/sound_system",function(t){function e(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"tourtle"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.sprite.animations.add("walk",[0,1,2,3,2,1],5),this.sprite.animations.add("dead",[4],5),this.sprite.play("walk",5,!0),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(32,13,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0}return e.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},e.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},e.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},e.prototype.damage=function(t){this.kill()},e.prototype.update=function(t){return null!=this.dead_timer?(this.dead_timer-=t,void(this.dead_timer<=0&&(this.owner=null,this.manager=null,this.sprite.entity=null,this.sprite.destroy()))):(this.sprite.x>this.x+parseInt(this.get("move"))?this.sprite.body.velocity.x=-(parseInt(this.get("speed"))||20):this.sprite.x<this.x-parseInt(this.get("move"))?this.sprite.body.velocity.x=parseInt(this.get("speed"))||20:0==this.sprite.body.velocity.x&&(this.sprite.body.velocity.x=(parseInt(2*Math.random())?1:-1)*(parseInt(this.get("speed"))||20)),void(this.sprite.body.velocity.x>0?this.sprite.scale.x=-1:this.sprite.scale.x=1))},e.prototype.kill=function(){this.dead_timer=.8,this.sprite.play("dead"),t.play("loss"),this.sprite.body.velocity.x=(parseInt(2*Math.random())?1:-1)*(parseInt(this.get("speed"))||20),this.sprite.body.velocity.y=-60,this.sprite.body.gravity.y=300},e.prototype.interact=function(t){this.sprite.body.touching.up?this.kill():t.damage&&t.damage()},e}]),define("games/sudi/src/npc",["games/sudi/src/collectable",function(t){function e(t,e){this.group=e,this.state=t,this.sprite=this.state.add.sprite(16,this.ground,"enemy"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.35,1),this.sprite.animations.add("idle",[0,1,2,1],7),this.sprite.animations.add("walk",[0,3,4,3],7),this.sprite.play("idle",7,!0),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(16,32,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.quest_done=!1}return e.prototype.shouldCollide=function(t){return!this.quest_done},e.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},e.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},e.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},e.prototype.damage=function(t){},e.prototype.update=function(t){},e.prototype.interact=function(e){var i=t.totalCount.coins-e.get("coins");0>=i?(this.manager.triggerById(parseInt(this.get("has_coins")),this,e,!0),this.quest_done=!0):(console.log("You missed "+i+" coins!"),console.log("Tell it to: "+this.get("has_nocoins")),this.manager.triggerById(parseInt(this.get("has_nocoins")),this,e,!0))},e.prototype.trigger=function(t,e){},e.prototype.trigger_end=function(t,e){},e}]),define("games/sudi/src/mole",["games/sudi/src/sound_system","games/sudi/src/hud",function(t,e){function i(t,e){window.mole=this,this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"mole"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.sprite.animations.add("idle",[0,1,2,1],5),this.attackAnimation=this.sprite.animations.add("attack",[3,4,5,6,7],5),this.sprite.animations.add("hidden",[8],1),this.hiddenAnim=this.sprite.play("hidden",5,!0),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(28,20,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.shootTimer=0}return i.prototype.trigger=function(t,e){this.sprite.play("idle",5,!0),this.target=e,this.shootTimer=.2},i.prototype.trigger_end=function(t,e){this.target_x=this.target.sprite.x,this.target_y=this.target.sprite.y,this.target=null},i.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},i.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},i.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},i.prototype.damage=function(t){this.kill()},i.prototype.update=function(t){return null!=this.dead_timer?(this.dead_timer-=t,void(this.dead_timer<=0&&(this.owner=null,this.manager=null,this.sprite.entity=null,this.sprite.destroy()))):(this.shootTimer>0&&(this.shootTimer-=t),void(this.target?(this.attackAnimation.isPlaying||this.sprite.play("idle",5,!0),this.sprite.scale.x=this.target.sprite.x-this.sprite.x<0?1:-1,this.target&&this.shootTimer<=0&&!this.attackAnimation.isPlaying&&(this.shootTimer=5,this.sprite.play("attack",5,!1).onComplete.addOnce(this.shoot,this))):!this.shooting&&this.shootTimer<=0&&this.sprite.play("hidden",5,!0)))},i.prototype.shoot=function(){this.manager.fireBullet(this,this.target,this.target_x,this.target_y),this.shootTimer=1,this.sprite.play("idle",5,!0)},i.prototype.kill=function(){this.hiddenAnim.isPlaying||(this.dead_timer=1,this.sprite.play("hidden",5,!0),t.play("loss"))},i.prototype.interact=function(t){this.sprite.body.touching.up&&this.kill()},i}]),define("games/sudi/src/game",["games/sudi/src/physics","games/sudi/src/map","games/sudi/src/entity_manager","games/sudi/src/collectable","games/sudi/src/sound_system","games/sudi/src/hud","games/sudi/src/spritesheet_generator",function(t,e,i,s,r,o,n){function a(){}return a.prototype.init=function(){console.log("init sudi game"),addLoadingScreen(this,!1)},a.prototype.preload=function(){this.load.path="games/"+currentGameData.id+"/assets/",this.load.tilemap("level1","maps/level1.json",null,Phaser.Tilemap.TILED_JSON),this.load.atlasJSONHash("atlas"),r.preload(this)},a.prototype.create=function(){Pad.init(this.game)},a.prototype.mycreate=function(){this.game.time.advancedTiming=!0,n.init(this.game),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,t.init(this.game),r.init(this),o.init(this),s.totalCount={},r.theme("standard"),this.entity_manager=new i(this),this.map=new e(this,this.entity_manager),this.map.load("level1","atlas"),this.game.stage.backgroundColor="#4488AA"},a.prototype.shutdown=function(){r.shutdown()},a.prototype.update=function(){var t=.001*this.time.physicsElapsedMS;this.entity_manager&&(this.entity_manager.update(t),o.update())},a.prototype.render=function(){this.game.debug.text(game.time.fps,2,14,"#00ff00"),this.entity_manager&&this.entity_manager.render()},a}]),define("games/sudi/src/entity_manager",["games/sudi/src/trigger","games/sudi/src/player","games/sudi/src/flag","games/sudi/src/tourtle","games/sudi/src/mole","games/sudi/src/bullet","games/sudi/src/trapdoor","games/sudi/src/lava","games/sudi/src/lever","games/sudi/src/cloud","games/sudi/src/music","games/sudi/src/collectable","games/sudi/src/speech","games/sudi/src/npc",function(Trigger,Player,Flag,Tourtle,Mole,Bullet,TrapDoor,Lava,Lever,Cloud,Music,Collectable,Speech,NPC){function EntityManager(t){function e(t){var e=t.add.group();return e.enableBody=!0,e.physicsBodyType=Phaser.Physics.ARCADE,e}this.state=t,this.groups={player:e(t),collectable:e(t),interactable:e(t),bullet:e(t),trigger:e(t),none:e(t)},this.worldGeometry=null}return EntityManager.prototype.getGroup=function(t){return t in this.groups?this.groups[t]:null},EntityManager.prototype.setWorldGeometry=function(t){this.worldGeometry=t},EntityManager.prototype.fireBullet=function(t,e,i,s){var r=new Bullet(this.state,this.getGroup("bullet"));r.owner=t,r.manager=this,r.setPosition(t.sprite.x+10*t.sprite.scale.x,t.sprite.y-(t.duck?0:8)),e?(r.sprite.body.velocity.x=e.sprite.x-r.sprite.x,r.sprite.body.velocity.y=e.sprite.y-r.sprite.y):i&&s?(r.sprite.body.velocity.x=i-r.sprite.x,r.sprite.body.velocity.y=s-r.sprite.y):r.sprite.body.velocity.x=t.sprite.scale.x,r.sprite.body.velocity.setMagnitude(150)},EntityManager.prototype.create_trigger_from_element=function(t){var e=new Trigger(this.state,this.getGroup("trigger"));e.manager=this,e.id=t.properties.id,e.setPosition(t.x,t.y),e.setSize(t.width,t.height),Object.keys(t.properties).forEach(function(i){e.set(i,t.properties[i])})},EntityManager.prototype.create_entity_from_element=function(element){if(element.properties["class"])try{var constructor=eval(element.properties["class"]),entity=new constructor(this.state,this.getGroup(element.properties.type));entity.manager=this,entity.id=element.properties.id,entity.setPosition(element.x+16,element.y),Object.keys(element.properties).forEach(function(t){entity.set(t,element.properties[t])})}catch(e){console.warn(e)}},EntityManager.prototype.triggerById=function(t,e,i,s){for(var r in this.groups)this.groups[r].forEachAlive(function(r){if(r.entity&&r.entity.id==t){var o=r.entity;o&&s?o.trigger(e,i):o&&!s&&o.trigger_end(e,i)}},this)},EntityManager.prototype.getById=function(t){var e=null;for(var i in this.groups)if(this.groups[i].forEachAlive(function(i){!e&&i.entity&&i.entity.id==t&&(e=i.entity)},this),e)break;return e},EntityManager.prototype.update=function(t){this.state.game.physics.arcade.collide(this.groups.player,this.worldGeometry,function(t,e){},null,this),this.state.game.physics.arcade.collide(this.groups.collectable,this.worldGeometry,function(t,e){},null,this),this.state.game.physics.arcade.collide(this.groups.player,this.groups.collectable,function(t,e){return e.entity.interact(t.entity),!0},null,this),this.state.game.physics.arcade.collide(this.groups.player,this.groups.interactable,function(t,e){return e.entity.interact(t.entity),!0},function(t,e){var i=null==e.entity.dead_timer&&(e.entity.shouldCollide?e.entity.shouldCollide(t.entity):!0);return i},this),this.state.game.physics.arcade.collide(this.groups.bullet,this.worldGeometry,function(t,e){t.entity.kill()},null,this),this.state.game.physics.arcade.collide(this.groups.bullet,this.groups.interactable,function(t,e){t.entity.interact(e.entity)},function(t,e){return t.entity.owner.group!=e.entity.group},this),this.state.game.physics.arcade.collide(this.groups.bullet,this.groups.player,function(t,e){t.entity.interact(e.entity)},function(t,e){return t.entity.owner!=e.entity&&(t.entity.shouldCollide?t.entity.shouldCollide(e.entity):!0)},this),this.state.game.physics.arcade.overlap(this.groups.player,this.groups.trigger,function(t,e){},function(t,e){return e.entity.interact(t.entity),!1},this),this.groups.player.forEach(function(e){e.entity.update(t)},this),this.groups.interactable.forEach(function(e){e.entity.update(t)},this),this.groups.bullet.forEach(function(e){e.entity.update(t)},this),this.groups.trigger.forEach(function(e){e.entity.update(t)},this),this.groups.none.forEach(function(e){e.entity.update(t)},this)},EntityManager.prototype.render=function(){if(this.debug){for(var t in this.groups)this.groups[t].forEach(function(t){this.state.game.debug.body(t)},this);this.worldGeometry.forEach(function(t){this.state.game.debug.body(t)},this)}},EntityManager}]),define("games/sudi/src/physics",function(){function t(){}return t.prototype.init=function(t){this.game=t,this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.time.desiredFps=60},new t}),define("games/sudi/src/sound_system",function(){function t(){this.volume=.05}return t.prototype.init=function(t){this.game=t,this.sounds={jump:this.game.add.audio("jump"),loss:this.game.add.audio("loss"),pickup:this.game.add.audio("pickup")},this.music={standard:this.game.add.audio("Netherplace_Looping",1,!0,!0),boss:this.game.add.audio("Goblin-Loop",1,!0,!0),cave:this.game.add.audio("Secret-Journey_Looping",1,!0,!0),win:this.game.add.audio("Dont-Mess-with-the-8-Bit-Knight",1,!0,!0)}},t.prototype.shutdown=function(){for(var t in this.music)this.music[t].stop()},t.prototype.preload=function(t){this.game=t,this.game.load.audio("jump","audio/jump.wav"),this.game.load.audio("loss","audio/loss.wav"),this.game.load.audio("pickup","audio/pickup.wav"),this.game.load.audio("Netherplace_Looping","audio/Netherplace_Looping.mp3"),this.game.load.audio("Goblin-Loop","audio/Goblin-Loop.mp3"),this.game.load.audio("Secret-Journey_Looping","audio/Secret-Journey_Looping.mp3"),this.game.load.audio("Dont-Mess-with-the-8-Bit-Knight","audio/Dont-Mess-with-the-8-Bit-Knight.mp3")},t.prototype.play=function(t){this.sounds[t].play("",0,this.volume)},t.prototype.theme=function(t){for(var e in this.music)this.music[e].stop();this.music[t].restart("",0,this.volume,!0)},new t}),define("games/sudi/src/bullet",function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"wormbullet"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.sprite.animations.add("idle",[0,1,2,1],5),this.sprite.animations.add("die",[3,4,5,6,7,8],5),this.sprite.play("idle",10,!0),this.sprite.scale.set(.8),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(22,8,0,-10),this.sprite.body.immovable=!1,this.sprite.body.collideWorldBounds=!0,this.sprite.body.bounce.set(0)}return t.prototype.shouldCollide=function(t){return null==this.dead_timer},t.prototype.kill=function(){this.dead_timer=.5,this.sprite.play("die",10),this.sprite.body.immovable=!0,this.sprite.body.velocity.set(0),this.sprite.alive=!1},t.prototype.interact=function(t){this.sprite.alive&&(this.sprite.body.touching.up?100*Math.random()<30&&this.manager.create_entity_from_element({x:this.sprite.x+16,y:this.sprite.y,properties:{type:"collectable","class":"Collectable",amount:"1",anchor:"0.5,1",animation:"wormbullet_0000,wormbullet_0001,wormbullet_0002,wormbullet_0001,5",
bounce:"1",gravity:"100",name:"worms",size:"22,8,0,-10",sound:"pickup",sprite:"atlas,wormbullet_0000"}}):t.damage&&t.damage(1),this.kill())},t.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.update=function(t){return null!=this.dead_timer?(this.dead_timer-=t,void(this.dead_timer<=0&&(this.owner=null,this.manager=null,this.sprite.entity=null,this.sprite.destroy()))):void 0},t}),define("games/sudi/src/spritesheet_generator",function(){function t(){this.standard_width=32,this.standard_height=32}return t.prototype.init=function(t){this.game=t},t.prototype.getFrames=function(t){this.game||console.error("SpritesheetGenerator not initialized");var e=[];for(var i in this.game.cache.getFrameData(t)._frames){var s=this.game.cache.getFrameData(t)._frames[i];s.name.match(/_\d+/)||e.push(s)}return e},t.prototype.createSpriteSheet=function(t,e){if(this.game||console.error("SpritesheetGenerator not initialized"),this.game.cache.checkImageKey(e))return void console.log("Dont create Spritesheet for: "+e);var i=this.game.cache.getFrameData(t).getFrameByName(e),s=this.game.make.sprite(0,0,t,i.name),r=this.game.add.bitmapData(i.width,i.height);r.draw(s,0,0),s.destroy(),this.game.cache.addImage(i.name,"",r.canvas);var o=this.game.cache.getFrameData(t).getFrameByName(e+"_0000");o?this.game.cache.addSpriteSheet(i.name,"",r.canvas,o.width,o.height):this.game.cache.addSpriteSheet(i.name,"",r.canvas,this.standard_width,this.standard_height)},new t}),define("games/sudi/src/lava",function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.tileSprite(0,0,32,64,"atlas","lavaanim_0000"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.04,.97),this.sprite.scale.set(1),this.sprite.angle=0,this.sparks=this.state.add.emitter(0,0,50),this.sprite.addChild(this.sparks),this.sparks.makeParticles(["atlas"],["smoke_0000","smoke_0001","smoke_0002"]),this.sparks.maxParticleScale=1,this.sparks.minParticleScale=1,this.sparks.setYSpeed(-10,-30),this.sparks.setXSpeed(0,0),this.sparks.gravity=0,this.sparks.width=32,this.sparks.minRotation=0,this.sparks.maxRotation=0,this.sparks.start(!1,800,100),this.sparks.y=-64,this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(32,64,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0}return t.prototype.set=function(t,e){"width"==t&&(this.sparks.width=28*e,this.sprite.width=32*e,this.sparks.x=this.sprite.width/2-.04*this.sprite.width,console.log("SparksY: "+this.sparks.y),this.sprite.body.setSize(32*e,64,0,0)),this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.damage=function(t){},t.prototype.update=function(t){this.sprite.tilePosition.x+=13*t,this.sparks.forEachAlive(function(t){t.alpha=t.lifespan/this.sparks.lifespan},this)},t.prototype.interact=function(t){t.damage()},t.prototype.trigger=function(t,e){},t.prototype.trigger_end=function(t,e){},t}),define("games/sudi/src/trigger",[function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,""),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.scale.set(1),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.x=0,this.y=0,this.already_triggered=!1,this.interactions={}}return t.prototype.interact=function(t){this.interactions.hasOwnProperty(t)||this.beginInteraction(t),this.interactions[t]=1},t.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.setSize=function(t,e){this.sprite.body.setSize(t,e)},t.prototype.update=function(t){var e=[];for(var i in this.interactions)this.interactions[i]-=1,this.interactions[i]<0&&e.push(i);for(var i in e)this.endInteraction(e[i]),delete this.interactions[e[i]]},t.prototype.beginInteraction=function(t){JSON.parse(this.get("trigger_once"))&&this.already_triggered||this.manager.triggerById(parseInt(this.get("target")),this,t,!0)},t.prototype.endInteraction=function(t){JSON.parse(this.get("trigger_once"))&&this.already_triggered||(this.manager.triggerById(parseInt(this.get("target")),this,t,!1),this.already_triggered=!0)},t}]),define("games/sudi/src/lever",function(){function t(t,e){this.state=t,this.group=e,this.sprite=this.state.add.sprite(0,0,"atlas","lever_0000"),this.group&&this.group.add(this.sprite),this.sprite.entity=this,this.sprite.anchor.set(.5,1),this.sprite.scale.set(1),this.sprite.angle=0,this.sprite.animations.add("open",Phaser.Animation.generateFrameNames("lever_",0,4,"",4),12),this.sprite.animations.add("close",Phaser.Animation.generateFrameNames("lever_",0,4,"",4).reverse(),12),this.state.game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(32,32,0,0),this.sprite.body.immovable=!0,this.sprite.body.collideWorldBounds=!0,this.open=!1}return t.prototype.set=function(t,e){this.properties=this.properties||{},this.properties[t]=e},t.prototype.get=function(t,e){return this.properties=this.properties||{},this.properties[t]||0},t.prototype.setPosition=function(t,e){this.x=this.sprite.x=t,this.y=this.sprite.y=e},t.prototype.damage=function(t){},t.prototype.update=function(t){},t.prototype["switch"]=function(t){this.open?this.sprite.play("close",12).onComplete.addOnce(function(){this.open=!1,this.manager.triggerById(parseInt(this.get("target")),this,t,!1)},this):this.sprite.play("open",12).onComplete.addOnce(function(){this.open=!0,this.manager.triggerById(parseInt(this.get("target")),this,t,!0)},this)},t.prototype.interact=function(t){JSON.parse(this.get("interact"))&&this["switch"](t)},t.prototype.trigger=function(t,e){this["switch"](e)},t.prototype.trigger_end=function(t,e){},t}),require("games/sudi/src/game",function(t){addMyGame("sudi","Wegfinder","SudDani","Finde den Ausgang","Bewegen","Springen","Schiessen und weiter",t)})}();